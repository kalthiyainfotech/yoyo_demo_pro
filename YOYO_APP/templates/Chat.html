{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YOYO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
        integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=edit_square" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,0,0,0&icon_names=diamond" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static "css/Yoyo.css" %}">
</head>

<body>
    <div class="w-[100%]">
        <div class="backdrop" id="backdrop"></div>
        
        
        <div class="gemini-data gemini-container gemini-main">
            <div class="flex justify-end items-center w-full">
                <button class="w-fit bg-blue-500 text-white px-4 py-1 rounded-md mt-4 mr-4" onclick="window.location.href='{% url "login" %}'">Login</button>
            </div>
            <div class="main-chat-area">
                <div class="chat-content-wrapper gemini-chat-content-wrapper" style="background-color: var(--bg-main);">
                    <div id="chat-history" class=" space-y-4 relative">

                    </div>

                    <div id="greeting-div"
                        class="absolute inset-0 flex flex-col items-center text-center justify-center pointer-events-none">

                        <!-- <h1 class="text-3xl font-medium"> Meet </h1> -->
                        <div id="yoyo-user-name">

                        </div>
                    </div>

                    <div class="input-area-wrapper">
                        <div class="relative border-2 rounded-3xl px-6 pt-4 pb-12"
                            style="border-color: var(--border-color);">
                            <div id="image-preview-container" class="mb-2 relative hidden group w-fit">
                                <img id="image-preview" class="max-w-[100px] max-h-[100px] rounded-md" />
                                <button id="remove-preview"
                                    class="absolute top-1 right-1 w-8 h-8 text-2xl bg-black bg-opacity-60 text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                    &times;
                                </button>

                            </div>

                            <textarea
                                id="user-input"
                                placeholder="Ask YOYO"
                                class="w-full text-sm md:text-base font-medium bg-transparent resize-none overflow-y-auto max-h-[150px] focus:outline-none"
                                style="color: var(--text-main);"
                                oninput="autoResize(this)"
                            ></textarea>

                            <div
                                class="input-area-buttons flex justify-between items-center text-[var(--sidebar-text);]">
                                <div class="flex gap-2 text-sm items-center">
                                    <div class="relative">
                                        <button id="plus-button"
                                            class="group h-10 w-10 flex items-center justify-center rounded-full hover:bg-[var(--bg-hover)]">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24"
                                                width="24px" fill="currentColor">
                                                <path d="M0 0h24v24H0V0z" fill="none" />
                                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
                                            </svg>
                                        </button>

                                        <div id="plus-dropdown"
                                            class="hidden absolute py-2 left-0 bottom-full mb-2 w-48 rounded-lg shadow-lg z-50"
                                            style="background-color: var(--dropdown-bg); color: var(--dropdown-text);">
                                            <button id="trigger-upload"
                                                class="w-full text-left px-4 py-2 flex items-center gap-2 hover:bg-[var(--dropdown-hover)]">
                                                <svg xmlns="http://www.w3.org/2000/svg" height="20px"
                                                    viewBox="0 -960 960 960" width="20px" fill="currentColor">
                                                    <path
                                                        d="M696-312q0 89.86-63.07 152.93Q569.86-96 480-96q-91 0-153.5-65.5T264-319v-389q0-65 45.5-110.5T420-864q66 0 111 48t45 115v365q0 40.15-27.93 68.07Q520.15-240 480-240q-41 0-68.5-29.09T384-340v-380h72v384q0 10.4 6.8 17.2 6.8 6.8 17.2 6.8 10.4 0 17.2-6.8 6.8-6.8 6.8-17.2v-372q0-35-24.5-59.5T419.8-792q-35.19 0-59.5 25.5Q336-741 336-706v394q0 60 42 101.5T480-168q60 1 102-43t42-106v-403h72v408Z" />
                                                </svg>
                                                Upload files
                                            </button>
                                            <button
                                                class="w-full text-left px-4 py-2 flex items-center gap-2 hover:bg-[var(--dropdown-hover)]">
                                                <svg xmlns="http://www.w3.org/2000/svg" height="20px"
                                                    viewBox="0 -960 960 960" width="20px" fill="currentColor">
                                                    <path
                                                        d="M232-120q-17 0-31.5-8.5t-22.29-22.09L80.79-320.41Q73-334 73-351t8-31l248-427q8-14 22.5-22.5t31.06-8.5h194.88q16.56 0 31.06 8.5t22.42 22.37L811-500q-21-5-42-4.5t-42 4.5L571-768H389L146-351l92 159h337q11 21.17 25.5 39.59Q615-134 634-120H232Zm68-171-27-48 172.95-302H514l110 192q-14.32 13-26.53 28.5T576-388l-96-168-111 194h196q-6 17-9.5 34.7-3.5 17.71-3.5 36.3H300Zm432 147v-108H624v-72h108v-108h72v108h108v72H804v108h-72Z" />
                                                </svg>
                                                Add from Drive
                                            </button>
                                        </div>
                                    </div>

                                    <!-- <div
                                        class="group h-10 rounded-full px-2 py-1 flex items-center font-bold relative hover:bg-[var(--bg-hover)]">
                                        <span class="material-icons-outlined">
                                            <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 20 20"
                                                height="20px" viewBox="0 0 20 20" width="20px" fill="currentColor">
                                                <rect fill="none" height="20" width="20" />
                                                <path
                                                    d="M17.85,8.5h-1.54c-0.48-2.03-1.93-3.68-3.82-4.48V4.5C12.5,5.33,11.83,6,11,6H9v1c0,0.55-0.45,1-1,1H7v2h1v2H7L3.64,8.64 C3.55,9.08,3.5,9.53,3.5,10c0,3.58,2.92,6.5,6.5,6.5V18c-4.42,0-8-3.58-8-8s3.58-8,8-8C13.91,2,17.15,4.8,17.85,8.5z M18,16.44 l-1.06,1.06l-2.56-2.56c-0.54,0.35-1.19,0.56-1.88,0.56C10.57,15.5,9,13.93,9,12s1.57-3.5,3.5-3.5S16,10.07,16,12 c0,0.69-0.21,1.34-0.56,1.88L18,16.44z M14.5,12c0-1.1-0.9-2-2-2s-2,0.9-2,2s0.9,2,2,2S14.5,13.1,14.5,12z" />
                                            </svg>
                                        </span>
                                        <span class="hidden sm:inline pl-1">Deep Research</span>
                                        <div class="absolute opacity-0 scale-95 group-hover:opacity-100 font-medium group-hover:scale-100 group-hover:translate-y-1 transform transition-all duration-300 top-[90%] text-xs p-2 mt-2 left-1/2 -translate-x-1/2 rounded whitespace-nowrap"
                                            style="background-color: var(--dropdown-text); color: var(--bg-main);">
                                            Get in-depth answers
                                        </div>
                                    </div>

                                    <div
                                        class="group h-10 rounded-full px-2 py-1 flex items-center font-bold relative hover:bg-[var(--bg-hover)]">
                                        <span class="material-icons-outlined">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24"
                                                width="20px" fill="currentColor">
                                                <path d="M0 0h24v24H0V0z" fill="none" />
                                                <path
                                                    d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12zm-7-2h2v-3h3V9h-3V6h-2v3h-3v2h3z" />
                                            </svg>
                                        </span>
                                        <span class="hidden sm:inline pl-1">Canvas</span>
                                        <div class="absolute opacity-0 scale-95 group-hover:opacity-100 font-medium group-hover:scale-100 group-hover:translate-y-1 transform transition-all duration-300 top-[90%] text-xs p-2 mt-2 left-1/2 -translate-x-1/2 rounded whitespace-nowrap"
                                            style="background-color: var(--dropdown-text); color: var(--bg-main);">
                                            Create docs and apps
                                        </div>
                                    </div> -->
                                </div>

                                <button id="send-button"
                                    class="group h-10 w-10 rounded-full flex items-center justify-center relative overflow-hidden transition-all duration-300 hover:bg-[var(--bg-hover)]">

                                    <span id="mic-icon"
                                        class="absolute transition-all duration-300 ease-in-out opacity-100 scale-100 translate-x-0">

                                        <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960"
                                            width="24px" fill="currentColor">
                                            <path
                                                d="M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z" />
                                        </svg>
                                    </span>

                                </button>
                            </div>
                            <input type="file" id="upload-preview-input" accept="image/*" class="hidden" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!------------------------------------------------->
    <!-- Help Center -->
    <div id="help_Data"
        class="flex flex-col hidden  justify-start fixed top-[100px] rounded-2xl right-[10px] bg-[--bg-main] shadow-[0_1px_3px_0_rgba(60,64,67,0.3),_0_4px_8px_3px_rgba(60,64,67,0.15)]  lg:w-[23%] md:w-[40%] sm:w-[50%] w-[90%] h-[70vh] overflow-y-auto">

        <!-- Sticky Header -->
        <div class="sticky top-0 left-0 py-3 pb-8 w-full flex items-center justify-between bg-[--bg-main] z-10">
            <p class="text-2xl text-[--text-main] text-center w-full">Help</p>
            <button id="help_close" class="absolute right-4 top-3">
                <i class="fa-solid fa-xmark text-2xl text-[--text-main]"></i>
            </button>
        </div>

        <!-- Scrollable Content -->
        <div class="text-[--text-main] space-y-3 pb-4 text-left">
            <h6 class="text-[16px] text-[--text-main] ps-4">Popular help resources</h6>


            <div class="flex items-center gap-3 hover:bg-[--dropdown-hover] py-2 px-4 cursor-pointer">
                <div
                    class="w-[40px] h-[40px] min-h-[40px] min-w-[40px] rounded-full bg-[--examples-btn-hover]  flex justify-center items-center ">
                    <i class="fa-regular fa-file-lines text-[--add-btn]"></i>
                </div>
                <span class="text-[16px] text-[--text-main]">Manage & delete your YOYO Apps activity</span>
            </div>
            <div class="flex items-center gap-3 hover:bg-[--dropdown-hover] py-2 px-4 cursor-pointer">
                <div
                    class="w-[40px] h-[40px] min-h-[40px] min-w-[40px] rounded-full bg-[--examples-btn-hover] flex justify-center items-center">
                    <i class="fa-regular fa-file-lines text-[--add-btn]"></i>
                </div>
                <span class="text-[16px] text-[--text-main]">Use YOYO Apps</span>
            </div>
            <div class="flex items-center gap-3 hover:bg-[--dropdown-hover] py-2 px-4 cursor-pointer">
                <div
                    class="w-[40px] h-[40px] min-h-[40px] min-w-[40px] rounded-full bg-[--examples-btn-hover] flex justify-center items-center">
                    <i class="fa-regular fa-file-lines text-[--add-btn]"></i>
                </div>
                <span class="text-[16px] text-[--text-main]">Use & manage apps in YOYO</span>
            </div>
            <div class="flex items-center gap-3 hover:bg-[--dropdown-hover] py-2 px-4 cursor-pointer">
                <div
                    class="w-[40px] h-[40px] min-h-[40px] min-w-[40px] rounded-full bg-[--examples-btn-hover] flex justify-center items-center">
                    <i class="fa-regular fa-file-lines text-[--add-btn]"></i>
                </div>
                <span class="text-[16px] text-[--text-main]">Find & manage your recent chats in YOYO Apps</span>
            </div>
            <div class="flex items-center gap-3 hover:bg-[--dropdown-hover] py-2 px-4 cursor-pointer">
                <div
                    class="w-[40px] h-[40px] min-h-[40px] min-w-[40px] rounded-full bg-[--examples-btn-hover] flex justify-center items-center">
                    <i class="fa-regular fa-file-lines text-[--add-btn]"></i>
                </div>
                <span class="text-[16px] text-[--text-main]">Where you can use the YOYO web app</span>
            </div>


            <a href="" class="text-[14px] text-[--add-btn] w-full block hover:bg-[--bg-hover] py-4 px-10">Visit help
                forum <i class="fa-solid fa-arrow-up-right-from-square"></i></a>

            <div class="bg-[--dropdown-hover] py-3 mx-5 rounded-full flex items-center px-5 cursor-pointer">
                <i class="fa-solid fa-magnifying-glass me-3"></i>
                <input type="search" class="w-full bg-transparent outline-none border-0 cursor-pointer">
            </div>

            <div class="py-4 border-t-[8px] border-b-[8px] border-[--border-color]-500">
                <p class="text-[--text-main] ps-4">Need more help?</p>
                <div class="flex items-center gap-3 hover:bg-[--dropdown-hover] py-2 px-4 mt-3  cursor-pointer">
                    <div
                        class="w-[40px] h-[40px] min-h-[40px] min-w-[40px] rounded-full bg-[--examples-btn-hover] flex justify-center items-center">
                        <i class="fa-solid fa-message text-[--add-btn]"></i>
                    </div>
                    <div>
                        <p class="text-[--text-main] text-[16px]">Ask the Help Community</p>
                        <span class="text-[--text-muted] text-[16px]">Get answers from community experts</span>
                    </div>
                </div>

            </div>

            <div class="flex items-center gap-3 hover:bg-[--dropdown-hover] py-2 px-4 mt-3  cursor-pointer">
                <div
                    class="w-[40px] h-[40px] min-h-[40px] min-w-[40px] rounded-full bg-[--examples-btn-hover] flex justify-center items-center">
                    <i class="fa-solid fa-circle-exclamation text-[--add-btn]"></i>
                </div>
                <p class="text-[16px] text-[--add-btn] font-medium">Report a problem</p>
            </div>
        </div>
    </div>
    <!-- *****help js***** -->
    <script>
        const help_Data = document.getElementById('help_Data');
        const help_close = document.getElementById('help_close');
        const open_help_center = document.getElementById('open_help_center');

        open_help_center.addEventListener('click', () =>
            help_Data.classList.remove('hidden')
        );
        help_close.addEventListener('click', () =>
            help_Data.classList.add('hidden')
        );
    </script>
    <!---------------------------------------------->
    <!---------------------------------------------->
    <!-- ************Feedback********* -->

    <div id="feedback-data"
        class="flex z-50 flex-col hidden justify-between fixed top-0 right-0 rounded-l-2xl bg-[#1F1F1F] shadow-[0_1px_3px_0_rgba(60,64,67,0.3),_0_4px_8px_3px_rgba(60,64,67,0.15)] lg:w-[28%] md:w-[40%] sm:w-[50%] w-[90%] h-[100vh] overflow-hidden">

        <!-- Sticky Header -->
        <div
            class="sticky top-0 left-0 py-5 px-4 w-full flex items-center justify-between bg-[#1F1F1F] shadow-[0_1px_4px_rgba(0,0,0,0.6)] z-10">
            <p class="text-lg text-white w-full">Send feedback to YOYO</p>
            <button id="feedback_close"
                class="absolute right-4 w-[50px] h-[50px] rounded-full top-3 hover:bg-[#303134]">
                <i class="fa-solid fa-xmark text-2xl text-white"></i>
            </button>
        </div>

        <!-- Scrollable Content + Bottom -->
        <div class="flex flex-col justify-between h-full overflow-y-auto">
            <div class="space-y-3 text-white p-4 text-left">
                <h6 class="text-[14px]">Describe your feedback (required)</h6>

                <textarea name="feedback_message" id="feedback_message"
                    placeholder="Tell us what prompted this feedback..." rows="4"
                    class="w-full bg-transparent border rounded p-2 outline-none focus:ring-2 focus:ring-[#8AB4F8] focus:border-0 text-[16px] text-white"></textarea>


                <span class="text-[12px]">Please don’t include any sensitive information <i
                        class="fa-regular fa-circle-question"></i></span>

                <p class="text-[16px]">A screenshot will help us better understand your feedback.</p>

                <div
                    class="w-full border text-center text-[#7cacf8] rounded-md py-2 hover:border-[#7cacf8] hover:bg-[#2A3039] cursor-pointer">
                    <p class="text-[15px]"><i class="fa-solid fa-desktop"></i> Capture screenshot</p>
                </div>
            </div>

            <!-- Fixed Bottom Section -->
            <div class="mt-auto  bg-[#1F1F1F] ">
                <div class="flex items-center gap-2 mb-4 px-4">
                    <input type="checkbox" name="checkbox" id="checkbox"
                        class="w-5 h-5 bg-[#1F1F1F] accent-[#7CACF8] cursor-pointer border rounded" />
                    <label for="checkbox" class="text-white cursor-pointer">
                        We may email you for more information or updates
                    </label>
                </div>

                <p class="text-[14px] text-white mb-4 px-4">
                    Some account and system information may be sent to YOYO. We will use it to fix problems and
                    improve
                    our services, subject to our Privacy Policy and Terms of Service. We may email you for more
                    information
                    or updates. Go to Legal Help to ask for content changes for legal reasons.
                </p>

                <div class="text-end shadow-[0_-4px_6px_rgba(0,0,0,0.15)] mt-2 p-4">
                    <button id="sendBtn" disabled class="bg-[#373737] py-2 px-6 rounded-lg text-white text-[16px]">
                        Send
                    </button>

                </div>
            </div>
        </div>
    </div>

    <!-- feedback js -->
    <script>
        const feedback_message = document.getElementById("feedback_message");
        const sendBtn = document.getElementById("sendBtn");
        const feedback_close = document.getElementById("feedback_close");
        const feedback_open = document.getElementById("feedback_open");
        const feedback_data = document.getElementById("feedback-data");

        feedback_open.addEventListener('click', () =>
            feedback_data.classList.remove('hidden')
        );
        feedback_close.addEventListener('click', () =>
            feedback_data.classList.add('hidden')
        );

        feedback_message.addEventListener("input", function () {
            if (feedback_message.value.trim().length > 0) {
                sendBtn.disabled = false;
                sendBtn.classList.remove("bg-[#373737]", "text-white");
                sendBtn.classList.add("bg-[#7CACF8]", "text-[#062E6F]");
            } else {
                sendBtn.disabled = true;
                sendBtn.classList.remove("bg-[#7CACF8]", "text-[#062E6F]");
                sendBtn.classList.add("bg-[#373737]", "text-white");
            }
        });
    </script>
    <!---------------------------------------------->


    <!-- -----------Profile JS---------------- -->

    <script>
        const accountData = JSON.parse(localStorage.getItem('login'))

        console.log(accountData);

        const allAccounts = JSON.parse(localStorage.getItem('accounts')) || [];

        const filteredAccounts = allAccounts.filter(acc => acc.email !== accountData.email);

        const accountsList = filteredAccounts
            .map((acc, index) => {

                return `
        <div onclick="switchAccount('${acc.email}')"
            class="flex items-center gap-3 p-4 h-[60px] sm:p-3 cursor-pointer bg-[--bg-main] hover:bg-[var(--sidebar-hover)] ">
            <div class="w-[36px] h-[36px]  bg-[#78909c] text-white flex items-center justify-center rounded-full font-semibold text-lg">
                ${acc.name.charAt(0).toUpperCase()}
            </div>
            <div class="text-left truncate overflow-hidden w-[175px] sm:w-auto">
                <div class="text-sm font-medium text-[var(--text-main)]">${acc.name}</div>
                <div class="text-xs text-[var(--text-muted)] truncate overflow-hidden whitespace-nowrap ">${acc.email}</div>
            </div>
        </div>`;
            }).join('');




        if (accountData) {
            document.getElementById('account').innerHTML =


                `<div class="relative">
                    <div class="relative group inline-block">
                        <button id="profile-button"
                        class="w-8 h-8 bg-[#78909c] rounded-full flex items-center justify-center text-white font-medium">
                        ${accountData.name.charAt(0).toUpperCase()}
                        </button>

                        <div id='account-tooltips' class="absolute z-[999] right-0 mt-1 min-w-56 p-2 bg-[#3c4043e6] hidden group-hover:block rounded">
                        <h5 class="text-[13px] text-[#E8EAED] font-medium m-0">Google Account</h5>
                        <p class="text-[13px] text-[#9AA0A6] font-medium m-0">${accountData.name}</p>
                        <p class="text-[13px] text-[#9AA0A6] font-medium m-0">${accountData.email}</p>
                        </div>
                    </div>

                    <div id="profile-dropdown"
                        class="absolute right-4 top-14 w-[400px] max-w-[90vw] sm:max-w-md rounded-3xl shadow-xl z-50 overflow-hidden"
                        style="background-color: var(--dropdown-bg); color: var(--dropdown-text);">
                        
                        <!-- Header -->
                       <div class="flex items-center relative px-4 pt-5 pb-2">
                            <div class="flex-1 text-center text-sm font-medium truncate px-2 max-w-[90%]"
                                style="color: var(--dropdown-text); ">
                                ${accountData.email}
                            </div>
                            <button id="profile-close"
                                class="text-lg absolute top-[14px] right-[6px] hover:bg-[var(--sidebar-hover)] w-[36px] h-[36px] rounded-full font-medium text-[var(--text-muted)]">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>



                        <!-- Avatar and Welcome -->
                        <div class="px-4 py-4 flex flex-col items-center">
                        <div class="relative">
                            <div id="profile-circle"
                            class="w-[75px] h-[75px] bg-[#78909c] rounded-full flex items-center justify-center text-white text-4xl font-medium mb-2 overflow-hidden cursor-pointer">
                            ${accountData.name.charAt(0).toUpperCase()}
                            </div>
                            <input type="file" id="profile-img-upload" accept="image/*" class="hidden" />
                            <div class="w-6 h-6 bottom-[4px] left-[53px] absolute rounded-full items-center justify-center flex pointer-events-none"
                            style="background-color:var(--sidebar-bg);">
                            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"
                                fill="currentColor">
                                <path
                                d="M480-264q72 0 120-49t48-119q0-69-48-118.5T480-600q-72 0-120 49.5t-48 119q0 69.5 48 118.5t120 49Zm0-72q-42 0-69-28.13T384-433q0-39.9 27-67.45Q438-528 480-528t69 27.55q27 27.55 27 67.45 0 40.74-27 68.87Q522-336 480-336ZM168-144q-29 0-50.5-21.5T96-216v-432q0-29 21.5-50.5T168-720h120l72-96h240l72 96h120q29.7 0 50.85 21.5Q864-677 864-648v432q0 29-21.15 50.5T792-144H168Zm0-72h624v-432H636l-72.1-96H396l-72 96H168v432Zm312-217Z" />
                            </svg>
                            </div>
                        </div>

                        <div class="text-center mt-2">
                            <div class="font-medium text-base sm:text-xl">Hi, ${accountData.name}</div>
                            <button class="text-sm mt-2 py-2 font-semibold border rounded-full px-5"
                            style="color: var(--accent-blue); border-color: var(--border-color);">Manage your Google Account</button>
                        </div>
                        </div>

                        
                        <!-- Add & Sign Out -->

                        ${accountsList ? `
                             <!-- Other Accounts (Toggleable) -->
                                <div class="flex flex-col gap-1 mt-3 mb-3 m-3 ">
                                        <button id="toggleAccountsBtn" class="w-full   flex justify-between items-center px-4 py-4 bg-[--bg-main] hover:bg-[--account-hover] transition rounded-t-3xl rounded-b-3xl">
                                            <span id="toggleText" class="text-base sm:text-base">Show more accounts</span>
                                            <i id="iconExpand" class="fa-solid fa-chevron-down transition-transform duration-300"></i>
                                        </button>


                                        <div id="accountList" class="hidden  flex flex-col gap-1 ">
                                            ${accountsList}

                                            <div onclick="handleRedirectLogin()" class="px-4 h-[60px] py-4 flex items-center text-sm justify-start  bg-[--bg-main] hover:bg-[--account-hover] cursor-pointer ">
                                                <div class="w-6 h-6 rounded-full flex items-center justify-center mr-2" style="background-color: var(--sidebar-hover);">
                                                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="var(--accent-blue)">
                                                    <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z" />
                                                </svg>
                                                </div>
                                                Add account
                                            </div>

                                        <div onclick="signOutAllAccounts()" class="px-4 h-[60px] py-4 flex items-center text-sm justify-start rounded-b-3xl  bg-[--bg-main] hover:bg-[--account-hover] cursor-pointer ">
                                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" class="mr-2" width="24px" fill="currentColor">
                                            <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z" />
                                            </svg>
                                            Sign out of all accounts
                                        </div>
                                        </div>
                                </div> `
                    :
                    `
                             <div class="flex justify-center items-center gap-[2px] px-4">
                                <div onclick="handleRedirectLogin()" class="px-4 h-[60px] py-4 flex items-center text-sm justify-start rounded-s-full bg-[--bg-main] hover:bg-[--account-hover] cursor-pointer w-[50%]">
                                    <div class="w-6 h-6 rounded-full flex items-center justify-center mr-2" style="background-color: var(--sidebar-hover);">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="var(--accent-blue)">
                                        <path d="M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z" />
                                    </svg>
                                    </div>
                                    Add account
                                </div>
                                <div onclick="handleRemoveLogin()" class="px-4 h-[60px] py-4 flex items-center text-sm justify-start rounded-e-full bg-[--bg-main] hover:bg-[--account-hover] cursor-pointer w-[50%]">
                                    <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" class="mr-2" width="24px" fill="currentColor">
                                    <path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h280v80H200v560h280v80H200Zm440-160-55-58 102-102H360v-80h327L585-622l55-58 200 200-200 200Z" />
                                    </svg>
                                    Sign out
                                </div>
                        </div>`
                }

                        <!-- Footer -->
                        <div class="px-4 py-4 flex justify-center items-center text-xs text-[--text-muted]">
                        <a href="#" class="mr-1 rounded-md p-2 hover:bg-[var(--sidebar-hover)]">Privacy Policy</a>
                        <span class="text-[5px]"> ● </span>
                        <a href="#" class="ml-1 rounded-md p-2 hover:bg-[var(--sidebar-hover)]">Terms of Service</a>
                        </div>
                    </div>
                    </div>`

            document.getElementById('yoyo-user-name').innerHTML = `
                             <h1
                                class="text-3xl bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 text-transparent bg-clip-text">
                                
                                Hello, ${accountData.name.split(" ")[0]}
                               
                            </h1>

                    `

            document.getElementById('greeting-div').classList.add('hidden')


        } else {

            document.getElementById('account').innerHTML = `
        <button 
            class="bg-[--add-btn] text-[--add-btn-text] font-bold py-2 px-4 rounded-lg" 
            onclick="handleRedirectLogin()">
            Login
        </button>`;


            document.getElementById('yoyo-user-name').innerHTML = `
                             <h1
                                class="text-3xl bg-gradient-to-r from-blue-400 via-purple-400 to-pink-400 text-transparent bg-clip-text">
                                <span class="text-[--text-main] ">Meet</span>
                                YOYO.
                                <h1 class="text-3xl  text-[--text-main] ">your personal AI assistant</h1>
                            </h1>

                    `

        }

        function handleRedirectLogin() {
            window.location.href = 'login.html?add=true';  // set flag
        }


        function signOutAllAccounts() {
            localStorage.removeItem('login');
            localStorage.removeItem('accounts');
            window.location.href = 'login.html?add=true'; // or wherever your login page is
        }



        function handleRemoveLogin() {
            const current = JSON.parse(localStorage.getItem('login'));
            let accounts = JSON.parse(localStorage.getItem('accounts')) || [];

            if (current) {
                // Remove current user from saved list
                accounts = accounts.filter(acc => acc.email !== current.email);
                localStorage.setItem('accounts', JSON.stringify(accounts));
            }

            // Set next user as login if available
            if (accounts.length > 0) {
                const nextUser = accounts[0]; // First saved user
                localStorage.setItem('login', JSON.stringify(nextUser));
                window.location.href = 'Yoyo.html'; // Auto redirect to app
            } else {
                // No user left, go to login page
                localStorage.removeItem('login');
                window.location.href = 'login.html';
            }
        }



        function switchAccount(email) {
            const allAccounts = JSON.parse(localStorage.getItem('accounts')) || [];
            const user = allAccounts.find(acc => acc.email === email);
            if (user) {
                localStorage.setItem('login', JSON.stringify(user));
                window.location.reload(); // or redirect as needed
            }
        }

        function removeAccount(email) {
            let accounts = JSON.parse(localStorage.getItem('accounts')) || [];
            accounts = accounts.filter(acc => acc.email !== email);
            localStorage.setItem('accounts', JSON.stringify(accounts));

            const current = JSON.parse(localStorage.getItem('login'));
            if (current && current.email === email) {
                localStorage.removeItem('login');
                window.location.href = 'login.html';
            } else {
                window.location.reload();
            }
        }




    </script>
    <script>
        const toggleBtn = document.getElementById("toggleAccountsBtn");
        const accountList = document.getElementById("accountList");
        const toggleText = document.getElementById("toggleText");
        const iconExpand = document.getElementById("iconExpand");

        toggleBtn.addEventListener("click", () => {
            const isVisible = !accountList.classList.contains("hidden");
            accountList.classList.toggle("hidden");

            // Update text and icon
            toggleText.textContent = isVisible ? "Show more accounts" : "Hide more accounts";
            iconExpand.classList.toggle("rotate-180", !isVisible);

            // Toggle bottom radius of the button
            if (!isVisible) {
                toggleBtn.classList.remove("rounded-b-3xl");
            } else {
                toggleBtn.classList.add("rounded-b-3xl");
            }
        });

    </script>

    <script>

        // Put this at the TOP of your Gemini.js file, before DOMContentLoaded
        function checkForGuideline() {
            // Try localStorage first
            let guideline = localStorage.getItem('guideline');

            // If not found in localStorage, check URL parameters
            if (!guideline) {
                const urlParams = new URLSearchParams(window.location.search);
                guideline = urlParams.get('guideline');
            }

            if (guideline) {
                console.log('Found guideline:', guideline);

                // Wait for input field to be available
                const checkInput = setInterval(() => {
                    const input = document.getElementById('user-input');
                    if (input) {
                        clearInterval(checkInput);
                        input.value = guideline;
                        console.log('Guideline set in input field');

                        // Clean up
                        localStorage.removeItem('guideline');
                        // Clean URL without reloading
                        window.history.replaceState({}, document.title, window.location.pathname);

                        // Optional: Focus and position cursor
                        input.focus();
                        input.selectionStart = input.selectionEnd = input.value.length;
                    }
                }, 100);
            }
        }

        // Call this function immediately when the script loads
        checkForGuideline();

        // Then continue with your existing DOMContentLoaded code...
        document.addEventListener('DOMContentLoaded', function () {
            // Your existing initialization code...
        });

    </script>

    <!-- ---------------------------------------------- -->


    <script src="{% static "js/Gemini.js" %}"></script>
    <script>
        (function(){
            const inputEl = document.getElementById('user-input');
            const sendBtn = document.getElementById('send-button');
            const chatHistory = document.getElementById('chat-history');

            function appendMessage(role, text) {
                const wrapper = document.createElement('div');
                wrapper.className = 'w-full flex';
                wrapper.style.gap = '12px';
                wrapper.style.alignItems = 'flex-start';
                if (role === 'user') {
                    wrapper.style.justifyContent = 'flex-end';
                    wrapper.innerHTML = `<div class="max-w-[80%] p-3 rounded-2xl" style="background-color: var(--accent-blue); color: #062E6F;">${escapeHtml(text)}</div>`;
                } else {
                    wrapper.style.justifyContent = 'flex-start';
                    wrapper.innerHTML = `<div class="max-w-[80%] p-3 rounded-2xl" style="background-color: var(--dropdown-bg); color: var(--dropdown-text);">${escapeHtml(text)}</div>`;
                }
                chatHistory.appendChild(wrapper);
                chatHistory.scrollTop = chatHistory.scrollHeight;
            }

            function escapeHtml(s){
                return String(s)
                    .replace(/&/g,'&amp;')
                    .replace(/</g,'&lt;')
                    .replace(/>/g,'&gt;')
                    .replace(/\"/g,'&quot;')
                    .replace(/'/g,'&#039;');
            }

            async function sendMessage() {
                const text = (inputEl?.value || '').trim();
                if (!text) { return; }

                // Optimistic render
                appendMessage('user', text);
                inputEl.value = '';
                inputEl.style.height = 'auto';

                // Typing indicator
                const typing = document.createElement('div');
                typing.className = 'w-full flex';
                typing.style.justifyContent = 'flex-start';
                typing.innerHTML = `<div class="max-w-[80%] p-3 rounded-2xl text-sm" style="background-color: var(--dropdown-bg); color: var(--dropdown-text); opacity: 0.8;">YOYO is typing...</div>`;
                chatHistory.appendChild(typing);
                chatHistory.scrollTop = chatHistory.scrollHeight;

                sendBtn.disabled = true;
                try {
                    const res = await fetch('/chat-out/send/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: text })
                    });
                    const data = await res.json().catch(() => ({ error: 'Invalid response' }));
                    typing.remove();
                    if (!res.ok || data.error) {
                        appendMessage('bot', data.error || 'Something went wrong.');
                    } else {
                        appendMessage('bot', data.bot_reply || '');
                    }
                } catch (e) {
                    typing.remove();
                    appendMessage('bot', 'Network error.');
                } finally {
                    sendBtn.disabled = false;
                }
            }

            if (sendBtn) {
                sendBtn.addEventListener('click', sendMessage);
            }

            if (inputEl) {
                inputEl.addEventListener('keydown', function(e){
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
        })();
    </script>

</body>

</html> 